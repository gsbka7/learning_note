import{_ as s,p as n,q as a,a1 as e}from"./framework-96b046e1.js";const p="/learning_note/images/mysql/04/relationa.png",t="/learning_note/images/mysql/04/1to1_1.png",o="/learning_note/images/mysql/04/1to1_2.png",c="/learning_note/images/mysql/04/1ton_nton.png",l="/learning_note/images/mysql/04/nton.png",i={},r=e('<h1 id="_04-【-資料庫的關聯關係-】" tabindex="-1"><a class="header-anchor" href="#_04-【-資料庫的關聯關係-】" aria-hidden="true">#</a> 04 【 資料庫的關聯關係 】</h1><blockquote><p>MySQL是關係型資料庫，不僅可以儲存資料，還可以維護資料與資料之間的關聯關系；通過在表單中增加字段建立外鍵</p></blockquote><p><img src="'+p+'" alt="Relationa"></p><p>資料與資料之間的關係分為四種：</p><p>・ 一對一</p><p>・ 一對多</p><p>・ 多對一</p><p>・ 多對多</p><h2 id="_1-一對一" tabindex="-1"><a class="header-anchor" href="#_1-一對一" aria-hidden="true">#</a> 1. 一對一</h2><p>・ 學生 -- 學號：一個學生只有一個學號</p><p>・ 使用者帳號 -- 使用者帳號資訊：一個使用者帳號只對應一個帳號資料</p><h3 id="_1-主鍵關聯" tabindex="-1"><a class="header-anchor" href="#_1-主鍵關聯" aria-hidden="true">#</a> 1. 主鍵關聯</h3><blockquote><p>兩張資料表中主鍵相同的資料互相對應</p></blockquote><p><img src="'+t+'" alt="1to1"></p><h3 id="_2-唯一外鍵" tabindex="-1"><a class="header-anchor" href="#_2-唯一外鍵" aria-hidden="true">#</a> 2. 唯一外鍵</h3><blockquote><p>在任意一張表單中新增一個外鍵字段與另一張表單的主鍵關聯，並且將外鍵列增加唯一限制(unique)</p></blockquote><p><img src="'+o+'" alt="1to1"></p><h2 id="_2-一對多-與-多對一" tabindex="-1"><a class="header-anchor" href="#_2-一對多-與-多對一" aria-hidden="true">#</a> 2. 一對多 與 多對一</h2><p>・ 班級 -- 學生 (一對多)：一個班級包含多個學生</p><p>・ 學生 -- 班級 (多對一)：多個學生只屬於同一個班級</p><blockquote><p>在欄位多的一端增加外鍵，與另一張表單的主鍵產生關連</p></blockquote><p><img src="'+c+'" alt="1to1"></p><h2 id="_3-多對多" tabindex="-1"><a class="header-anchor" href="#_3-多對多" aria-hidden="true">#</a> 3. 多對多</h2><p>・ 學生 -- 課程：一個學生可以選擇多門課，一門課也可以由多個學生選擇</p><p>・ 學生 -- 社團：一個學生可以選擇多個社團，一個社團也可以由多個學生選擇</p><blockquote><p>額外建立一張關係表單來維護多對多關聯 -- 在關聯表中定義兩個外鍵，分別與兩個資料表的主鍵進行關聯；也可以在關聯表中新增欄位寫入資料</p></blockquote><p><img src="'+l+`" alt="1to1"></p><p>https://www.bilibili.com/video/BV1qb4y1Y722?p=50</p><h2 id="_4-外鍵限制" tabindex="-1"><a class="header-anchor" href="#_4-外鍵限制" aria-hidden="true">#</a> 4. 外鍵限制</h2><blockquote><p>將一個列增加外鍵限制與另一張表單的主鍵(唯一列)進行關聯之後，這個外鍵限制的列增加的資料必須要在關聯的主鍵字段中存在</p></blockquote><p>舉例：學生表單 與 班級表單 (在學生表單中增加外鍵與班級表單的主鍵進行關聯)</p><h3 id="_1-建立班級表單" tabindex="-1"><a class="header-anchor" href="#_1-建立班級表單" aria-hidden="true">#</a> 1. 建立班級表單</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> classes<span class="token punctuation">(</span>
    class_id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
    class_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">unique</span><span class="token punctuation">,</span>
    class_remark <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-建立學生表單欄位" tabindex="-1"><a class="header-anchor" href="#_2-建立學生表單欄位" aria-hidden="true">#</a> 2. 建立學生表單欄位</h3><h4 id="方式1" tabindex="-1"><a class="header-anchor" href="#方式1" aria-hidden="true">#</a> 方式1</h4><p>建立表單時，定義 cid，添加外鍵約束條件</p><p>由於 cid 列要與 class_id 進行關聯，因此兩者型態與長度要一致</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> students<span class="token punctuation">(</span>
    stu_num <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    stu_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    stu_gender <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    stu_age <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    cid <span class="token keyword">int</span><span class="token punctuation">,</span>
    <span class="token keyword">constraint</span> FK_STUDENTS_CLASS <span class="token keyword">foreign</span> <span class="token keyword">key</span><span class="token punctuation">(</span>cid<span class="token punctuation">)</span> <span class="token keyword">references</span> classes<span class="token punctuation">(</span>class_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="方式2" tabindex="-1"><a class="header-anchor" href="#方式2" aria-hidden="true">#</a> 方式2</h4><p>先建立表單，再添加外鍵限制</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> students<span class="token punctuation">(</span>
    stu_num <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    stu_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    stu_gender <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    stu_age <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    cid <span class="token keyword">int</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 建立表單後，為cid增加外鍵限制</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> students <span class="token keyword">add</span> <span class="token keyword">constraint</span> FK_STUDENTS_CLASSES <span class="token keyword">foreign</span> <span class="token keyword">key</span><span class="token punctuation">(</span>cid<span class="token punctuation">)</span> <span class="token keyword">references</span> classes<span class="token punctuation">(</span>class_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 如果發生錯誤，可能是因為資料庫已經有資料存在，需要使用delete from students清空表單資料;</span>

<span class="token comment">// 刪除外鍵限制</span>
alert <span class="token keyword">table</span> students <span class="token keyword">drop</span> <span class="token keyword">foreign</span> <span class="token keyword">key</span> FK_STUDENTS_CLASSES<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-聯級操作" tabindex="-1"><a class="header-anchor" href="#_3-聯級操作" aria-hidden="true">#</a> 3. 聯級操作</h3><p>向表單中添加班級資料</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> classes<span class="token punctuation">(</span>class_name<span class="token punctuation">,</span>class_remark<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">&#39;Java2104&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;...&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> classes<span class="token punctuation">(</span>class_name<span class="token punctuation">,</span>class_remark<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">&#39;Java2106&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;...&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> classes<span class="token punctuation">(</span>class_name<span class="token punctuation">,</span>class_remark<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">&#39;Java2108&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;...&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> classes<span class="token punctuation">(</span>class_name<span class="token punctuation">,</span>class_remark<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">&#39;Python2106&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;...&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-向表單中添加學生資料" tabindex="-1"><a class="header-anchor" href="#_4-向表單中添加學生資料" aria-hidden="true">#</a> 4. 向表單中添加學生資料</h4><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> students<span class="token punctuation">(</span>stu_num<span class="token punctuation">,</span>stu_name<span class="token punctuation">,</span>stu_gender<span class="token punctuation">,</span>stu_age<span class="token punctuation">,</span>cid<span class="token punctuation">)</span>
<span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">&#39;20220202&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;name2&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;女&#39;</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 會發生錯誤，因為cid關連到的class_id沒有10(資料10不存在)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> students<span class="token punctuation">(</span>stu_num<span class="token punctuation">,</span>stu_name<span class="token punctuation">,</span>stu_gender<span class="token punctuation">,</span>stu_age<span class="token punctuation">,</span>cid<span class="token punctuation">)</span>
<span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">&#39;20220202&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;name2&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;女&#39;</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>當學生表單中存在的學生資料關聯到班級表單中的某條資料時，就不能對班級表單的這條紀錄修改ID和刪除操作</p></blockquote><p>如果需要修改Java2104的class_id：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">// 1. 將引用Java2104班級id的學生表單中的cid修改為NULL</span>
<span class="token keyword">update</span> students <span class="token keyword">set</span> cid<span class="token operator">=</span><span class="token string">&#39;NULL&#39;</span> <span class="token keyword">where</span> cid<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 修改班級資料表中Java2104紀錄的class_id</span>
<span class="token keyword">update</span> classes <span class="token keyword">set</span> class_id<span class="token operator">=</span><span class="token number">5</span> <span class="token keyword">where</span> class_name<span class="token operator">=</span><span class="token string">&#39;Java2104&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// 3. 將學生表單中cid設為NULL的資料重新修改為新的Java2104這個班級的新的id</span>
<span class="token keyword">update</span> students <span class="token keyword">set</span> class_id<span class="token operator">=</span><span class="token number">5</span> <span class="token keyword">where</span> cid <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-級聯修改、級聯刪除" tabindex="-1"><a class="header-anchor" href="#_5-級聯修改、級聯刪除" aria-hidden="true">#</a> 5. 級聯修改、級聯刪除</h4><blockquote><p>某條資料修改或刪除時，與該資料關聯的其他表單中的資料會一起被修改</p></blockquote><h5 id="_1-在新增外鍵時-設定聯級修改和聯級刪除" tabindex="-1"><a class="header-anchor" href="#_1-在新增外鍵時-設定聯級修改和聯級刪除" aria-hidden="true">#</a> 1. 在新增外鍵時，設定聯級修改和聯級刪除</h5><p>先刪除原有的外鍵</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>alert <span class="token keyword">table</span> students <span class="token keyword">drop</span> <span class="token keyword">foreign</span> <span class="token keyword">key</span> FK_STUDENTS_CLASSES<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>指定<strong>級聯修改</strong>、<strong>級聯刪除</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>alert <span class="token keyword">table</span> stadents <span class="token keyword">add</span> <span class="token keyword">constraint</span> FK_STUDENTS_CLASSES <span class="token keyword">foreign</span> <span class="token keyword">key</span><span class="token punctuation">(</span>cid<span class="token punctuation">)</span> <span class="token keyword">references</span> classes<span class="token punctuation">(</span>class_id<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="_2-測試級聯修改" tabindex="-1"><a class="header-anchor" href="#_2-測試級聯修改" aria-hidden="true">#</a> 2. 測試級聯修改</h5><blockquote><p>直接修改Java2104的class_id，關聯Java2104這個班級的學生資料的cid也會同步修改</p></blockquote><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">update</span> classes <span class="token keyword">set</span> class_id<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">where</span> class_name<span class="token operator">=</span><span class="token string">&#39;Java2104&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="_3-測試級聯刪除" tabindex="-1"><a class="header-anchor" href="#_3-測試級聯刪除" aria-hidden="true">#</a> 3. 測試級聯刪除</h5><blockquote><p>刪除class_id=1的班級資料，學生表單中引用此班級資料的資料也會被同步刪除</p></blockquote><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">delete</span> classes <span class="token keyword">set</span> class_id<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">where</span> class_name<span class="token operator">=</span><span class="token string">&#39;Java2104&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,62),d=[r];function u(k,m){return n(),a("div",null,d)}const b=s(i,[["render",u],["__file","04.html.vue"]]);export{b as default};
